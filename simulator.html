<!-- Application menu -->
<nav class="navbar navbar-inverse navbar-fixed-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
				<span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span>
				<span class="icon-bar"></span> <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand"><i class="fa fa-area-chart"></i>&nbsp;NLB HA Node Cluster PoC</a>
		</div>
		<!-- Collapsable parameters -->
		<div class="collapse navbar-collapse" id="navbar-collapse">
			<form class="navbar-form navbar-right">
				<!-- STRESS BY REQUESTS: Number of total requests to be fired -->
				<div class="form-group form-group-sm" *ngIf="isRequestMethod()">
					<div class="input-group input-group-sm">
						<span class="input-group-addon"><span class="hidden-sm">Requests</span><span class="visible-sm">Reqs</span></span>
						<input type="number" class="form-control input-sm" min="1" max="16384" id="numReq" [(ngModel)]="reqCount" [disabled]="isRunning()"/>
					</div>
				</div>
				<!-- STRESS BY DURATION AND DELAY: Duration in seconds to run -->
				<div class="form-group form-group-sm" *ngIf="isDurationMethod()">
					<div class="input-group input-group-sm">
						<span class="input-group-addon"><span class="hidden-sm">Duration</span><span class="visible-sm">Dur</span></span>
						<input type="number" class="form-control input-sm" min="5" max="600" id="durReq" [(ngModel)]="reqDuration" [disabled]="isRunning()"/>
						<span class="input-group-addon">(s)</span>
					</div>
				</div>
				<!-- STRESS BY DURATION AND DELAY: Delay in miliseconds to wait between group of requests -->
				<div class="form-group form-group-sm" *ngIf="isDurationMethod()">
					<div class="input-group input-group-sm">
						<span class="input-group-addon"><span class="hidden-sm">Interval (ms)</span><span class="visible-sm">Int(ms)</span></span>
						<input type="number" class="form-control input-sm" min="5" max="1000" id="intReq" [(ngModel)]="reqInterval" [disabled]="isRunning()"/>
						<span class="input-group-addon">(ms)</span>
					</div>
				</div>
				<!-- ALL: Maximum number of concurrent HTTP connections to be fired -->
				<div class="form-group form-group-sm">
					<div class="input-group input-group-sm">
						<span class="input-group-addon"><span class="hidden-sm">Connections</span><span class="visible-sm">Conn</span></span>
						<input type="number" class="form-control input-sm" min="1" max="32" id="numConn" [(ngModel)]="reqConn" [disabled]="isRunning()"/>
					</div>
				</div>
				<!-- Endpoint configuration -->
				<!--<div class="form-group form-group-sm">-->
				<!--<div class="input-group input-group-sm">-->
				<!--<span class="input-group-addon" id="basic-addon3"><span class="hidden-sm">API Endpoint</span><span class="visible-sm">API</span></span>-->
				<!--<select class="form-control input-sm" id="apiUrl" [(ngModel)]="selectedUrl" [disabled]="isRunning()" required>-->
				<!--<option *ngFor="let opt of urlOptions" [value]="opt[0]">{{opt[1]}}</option>-->
				<!--</select>-->
				<!--</div>-->
				<!--</div>-->
			</form>
			<ul class="nav navbar-nav navbar-right">
				<!-- Show reference -->
				<button type="button" class="btn btn-default btn-sm navbar-btn" (click)="showRef()" [disabled]="isRunning()">
					<span [hidden]="showReference">Show Reference</span><span [hidden]="!showReference">Hide Reference</span>
				</button>
				&nbsp;
				<!-- Quick settings dropdown -->
				<div class="btn-group btn-group-sm">
					<button type="button" class="btn btn-default navbar-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" [disabled]="isRunning()">Preset&nbsp;<span class="caret"></span>
					</button>
					<ul class="dropdown-menu">
						<li><a (click)="setSmall()">Small</a></li>
						<li><a (click)="setMedium()">Medium</a></li>
						<li><a (click)="setLarge()">Large</a></li>
						<li><a (click)="setHuge()">Huge</a></li>
					</ul>
				</div>
				<!-- Duration or Requests -->
				<div class="btn-group btn-group-sm">
					<button type="button" class="btn btn-default navbar-btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" [disabled]="isRunning()">Method&nbsp;<span class="caret"></span>
					</button>
					<ul class="dropdown-menu">
						<li><a (click)="setDuration()">Duration</a></li>
						<li><a (click)="setRequests()">Requests</a></li>
					</ul>
				</div>
			</ul>
		</div>
	</div>
</nav><!-- Statistics -->
<div class="row" *ngIf="!isRunning() && reqOK!==0 && !showReference">
	<!-- Requests statistical histogram -->
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-tachometer"></i>&nbsp;Request Duration Histogram</h4>
			</div>
			<table class="table table-striped table-condensed table-bordered table-responsive">
				<thead>
				<tr>
					<th width="28%" class="text-center">Requests</th>
					<th width="18%" class="text-center">AngularJS<br/>
						<small>(t7-t0)</small>
					</th>
					<th width="18%" class="text-center">nginX<br/>
						<small>(t6-t1)</small>
					</th>
					<th width="18%" class="text-center">Node.js<br/>
						<small>(t5-t2)</small>
					</th>
					<th width="18%" class="text-center">redis.io<br/>
						<small>(t4-t3)</small>
					</th>
				</tr>
				</thead>
				<tbody>
				<tr *ngFor="let hst of histogram">
					<td class="text-center">
						<small><strong>{{hst[0]}}% <i>(up to {{calcPosition(hst[0])}})</i></strong></small>
					</td>
					<td class="text-center">
						<small>{{hst[1] | number:'1.0-0'}} ms</small>
					</td>
					<td class="text-center">
						<small>{{hst[2] | number:'1.0-0'}} ms</small>
					</td>
					<td class="text-center">
						<small>{{hst[3] | number:'1.3-3'}} ms</small>
					</td>
					<td class="text-center">
						<small>{{hst[4] | number:'1.3-3'}} ms</small>
					</td>
				</tr>
				<tr class="info">
					<th class="text-center">
						<small><i>Throughput &#956;&#177;2&#963;</i></small>
					</th>
					<th class="text-center">
						<small>{{tpAngular | number:'1.0-0'}} req/s</small>
					</th>
					<th class="text-center">
						<small>{{tpNginx | number:'1.0-0'}} req/s</small>
					</th>
					<th class="text-center">
						<small>{{tpNode | number:'1.0-0'}} req/s</small>
					</th>
					<th class="text-center">
						<small>{{tpRedis | number:'1.0-0'}} req/s</small>
					</th>
				</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- nginX average duration donut chart -->
	<div class="col-xs-12 col-sm-6  col-md-6  col-lg-3">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-area-chart"></i>&nbsp;nginX Avg <i>&#956;&#177;2&#963;</i> (ms)
				</h4>
			</div>
			<div class="panel-body">
				<nvd3 [options]="polarChartOptions" [data]="polarChartData"></nvd3>
			</div>
		</div>
	</div>
	<!-- AngularJS average duration donut chart -->
	<div class="col-xs-12 col-sm-6  col-md-6  col-lg-3">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-area-chart"></i>&nbsp;AngularJS Avg
					<i>&#956;&#177;2&#963;</i> (ms)</h4>
			</div>
			<div class="panel-body">
				<nvd3 [options]="polarChartOptions2" [data]="polarChartData2"></nvd3>
			</div>
		</div>
	</div>
	<!-- Latency by Percentile Distribution lineBar chart -->
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-area-chart"></i>&nbsp;HDR Histogram w/o Coordinated Omission
				</h4>
			</div>
			<div class="panel-body">
				<nvd3 [options]="lineChartOptions" [data]="lineChartData"></nvd3>
			</div>
		</div>
	</div>
	<!-- Requests duration distribution multiBar chart -->
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-area-chart"></i>&nbsp;Requests Duration (ms)</h4>
			</div>
			<div class="panel-body">
				<nvd3 [options]="barChartOptions" [data]="barChartData"></nvd3>
			</div>
		</div>
	</div>
</div>
<!-- Balanced requests tables per node cluster -->
<div class="row" *ngIf="!isRunning() && reqOK!==0 && !showReference">
	<div class="col-xs-12 col-sm-6 col-md-3" *ngFor="let nodes of results">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-server"></i>&nbsp;{{nodes[0]}}
					<small>({{nodeIdx[nodes[0]][1]}})</small>
				</h4>
			</div>
			<table class="table table-striped table-condensed table-bordered table-responsive">
				<thead>
				<tr>
					<th *ngFor="let pid of nodes[1]" class="text-center">
						<i class="fa fa-sitemap"></i><br/>{{pid[0]}}<br/>
						<small>({{pid[1].length}})</small>
					</th>
				</tr>
				</thead>
				<tbody>
				<tr>
					<td *ngFor="let pid of nodes[1]" class="text-center">
						<code *ngFor="let req of pid[1]">{{req}}<br/></code>
					</td>
				</tr>
				</tbody>
			</table>
		</div>
	</div>
</div><!-- Reference -->
<div class="row" *ngIf="showReference">
	<!-- Sequence diagram static diagram -->
	<div class="col-xs-12 col-lg-6">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-sitemap"></i>&nbsp;Sequence Diagram</h4>
			</div>
			<img class="img-responsive" src="./sequence-diagram.png">
		</div>
	</div>
	<!-- Execution architecture static diagram -->
	<div class="col-xs-12 col-lg-6">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-sitemap"></i>&nbsp;Execution Architecture</h4>
			</div>
			<img class="img-responsive" src="./execution-arch.png">
		</div>
	</div>
	<!-- Reference links -->
	<div class="col-xs-12">
		<div class="panel panel-info">
			<div class="panel-heading">
				<h4 class="panel-title"><i class="fa fa-sitemap"></i>&nbsp;Reference Links</h4>
			</div>
			<div class="panel-body">
				<div class="row">
					<div class="col-xs-12 col-sm-6">
						<!-- HTTP/2 -->
						<blockquote>
							<dl>
								<dt>HTTP/2</dt>
								<dd>
									<footer *ngFor="let link of links['HTTP2']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- pm2 -->
						<blockquote>
							<dl>
								<dt>Keymetrics pm2 (v1.1.3)</dt>
								<dd>
									<footer *ngFor="let link of links['pm2']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- AngularJS 2 -->
						<blockquote>
							<dl>
								<dt>AngularJS 2 (v2.0.0-rc1)
								</dt>
								<dd>
									<footer *ngFor="let link of links['angular2']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- ng2-nvd3 -->
						<blockquote>
							<dl>
								<dt>ng2-nvd3 Charting Library (v1.1.1)
								</dt>
								<dd>
									<footer *ngFor="let link of links['ng2nvd3']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- stunnel -->
						<blockquote>
							<dl>
								<dt>stunnel (v5.32)</dt>
								<dd>
									<footer *ngFor="let link of links['stunnel']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- Github -->
						<blockquote>
							<dl>
								<dt>GitHub</dt>
								<dd>
									<footer *ngFor="let link of links['github']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
					</div>
					<div class="col-xs-12 col-sm-6">
						<!-- nginX -->
						<blockquote>
							<dl>
								<dt>nginX (opensource v1.11.1)
								</dt>
								<dd>
									<footer *ngFor="let link of links['nginx']">
										<a [href]="link.href" target="_blank">{{link.desc}}</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- HDR Histograms / Coordinated Omission -->
						<blockquote>
							<dl>
								<dt>HDR Histograms w/o Coordinated Omission (v2.1.9)
								</dt>
								<dd>
									<footer>
										<a href="http://bravenewgeek.com/everything-you-know-about-latency-is-wrong/" target="_blank">Everything You Know About Latency Is Wrong</a><br/>
									</footer>
									<footer>
										<a href="http://hdrhistogram.org/" target="_blank">HdrHistogram: A High Dynamic Range Histogram</a><br/>
									</footer>
									<footer>
										<a href="https://github.com/giltene/wrk2" target="_blank">a HTTP benchmarking tool based mostly on wrk</a><br/>
									</footer>
									<footer>
										<a href="https://www.npmjs.com/package/native-hdr-histogram" target="_blank">node.js bindings for hdr histogram C implementation</a><br/>
									</footer>
									<footer>
										<a href="http://psy-lob-saw.blogspot.com.br/2015/02/hdrhistogram-better-latency-capture.html" target="_blank">HdrHistogram: A better latency capture method</a><br/>
									</footer>
									<footer>
										<a href="https://www.youtube.com/watch?v=6Rs0p3mPNr0" target="_blank">How NOT to measure latency - Gil Tene</a><br/>
									</footer>
									<footer>
										<a href="https://nirajrules.wordpress.com/2009/09/17/measuring-performance-response-vs-latency-vs-throughput-vs-load-vs-scalability-vs-stress-vs-robustness/" target="_blank">Performance Testing – Response vs. Latency vs. Throughput vs. Load vs. Scalability vs. Stress vs. Robustness</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- Redis.io -->
						<blockquote>
							<dl>
								<dt>redis.io (v3.2.1)
								</dt>
								<dd>
									<footer>
										<a href="http://redis.io/" target="_blank">redis.io - open source in-memory data structure store (database, cache and message broker)</a><br/>
									</footer>
									<footer>
										<a href="http://redis.js.org/" target="_blank">REDIS - A Node.js redis client</a><br/>
									</footer>
									<footer>
										<a href="http://redis.io/topics/rediscli" target="_blank">redis-cli, the Redis command line interface</a><br/>
									</footer>
									<footer>
										<a href="http://bluebirdjs.com/docs/getting-started.html" target="_blank">Bluebird - full featured promise library with unmatched performance</a><br/>
									</footer>
									<footer>
										<a href="http://redis.io/topics/latency" target="_blank">Redis latency problems troubleshooting</a><br/>
									</footer>
									<footer>
										<a href="http://redis.io/topics/latency-monitor" target="_blank">Redis latency monitoring framework</a><br/>
									</footer>
									<footer>
										<a href="https://www.datadoghq.com/blog/how-to-collect-redis-metrics/" target="_blank">How to collect Redis metrics</a><br/>
									</footer>
									<footer>
										<a href="https://www.datadoghq.com/wp-content/uploads/2013/09/Understanding-the-Top-5-Redis-Performance-Metrics.pdf" target="_blank">Understanding the Top 5 Redis Performance Metrics</a><br/>
									</footer>
									<footer>
										<a href="http://www.iamtherealbill.com/2014/12/redis-performance-thoughts-2/" target="_blank">More Thoughts on Redis Performance</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
						<!-- Node.js -->
						<blockquote>
							<dl>
								<dt>Node.js (v6.2.2)
								</dt>
								<dd>
									<footer>
										<a href="https://nodejs.org/en/" target="_blank">Node.js - a JavaScript runtime built on Chrome's V8 JavaScript engine</a><br/>
									</footer>
									<footer>
										<a href="http://thisdavej.com/beginners-guide-to-installing-node-js-on-a-raspberry-pi/" target="_blank">Beginner’s Guide to Installing Node.js on a Raspberry Pi</a><br/>
									</footer>
									<footer>
										<a href="http://blog.keithcirkel.co.uk/load-balancing-node-js/" target="_blank">Load balancing Node.js</a><br/>
									</footer>
									<footer>
										<a href="https://www.npmjs.com/package/http2" target="_blank">An HTTP/2 client and server implementation</a>
									</footer>
								</dd>
							</dl>
						</blockquote>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Spinner -->
<div class="row" *ngIf="isRunning()">
	<div class="col-xs-12 text-center">
		<h1 [hidden]="calculating">Running...</h1>
		<h1 [hidden]="!calculating">Calculating statistics...</h1>
		<!--<div class="panel panel-success">-->
			<!--<div class="panel-heading">-->
				<!--<h4 class="panel-title">{{reqOK}} API requests sent</h4>-->
			<!--</div>-->
            <!--<table class="table table-condensed table-responsive">-->
                <!--<tbody>-->
                    <!--<tr [hidden]="reqOK<2">-->
                        <!--<td class="bg-primary text-right" width="{{percValue()}}%"><h2>{{percValue()}}%</h2></td>-->
                        <!--<td class="bg-info"></td>-->
                    <!--</tr>-->
                <!--</tbody>-->
            <!--</table>-->
		<!--</div>-->
	</div>
</div>
<!-- Footer fixed bar -->
<nav class="navbar navbar-inverse navbar-fixed-bottom">
	<div class="container-fluid text-right">
		&nbsp;<button type="submit" class="btn btn-primary navbar-btn" (click)="initSimulator()" [disabled]="isRunning()">Run&nbsp;<i class="fa fa-play"></i></button>&nbsp;
		<span class="navbar-text">Last run: {{duration | number:'1.0-0'}} ms</span>
	</div>
</nav>
